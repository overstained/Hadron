module.exports = function () {
	return {
		STORE_FILE: 'function(email, boardId, fileDoc){ var document = db.hadronUsers.findOne({email:email}); if(document == null) return; for(var i=0;i<document.boards.length;i++){if(document.boards[i].id === boardId){document.boards[i].files.push(fileDoc); db.hadronUsers.save(document);}}}',
		GET_FILES_FOR_BOARD: 'function(ownerEmail, boardName){ var document = db.hadronUsers.findOne({email:ownerEmail}); for(var i=0;i<document.boards.length;i++) { if(document.boards[i].name === boardName) { return document.files; } } }',
		GET_FILES_FOR_USER: 'function(email){ var document = db.hadronUsers.findOne({email:email}); var files = []; for(var i=0;i<document.boards.length;i++) { files = files.concat(document.boards[i].files);} return files; }',
		LAST_MODIFIED_BOARD: 'function(email){  var document = db.hadronUsers.findOne({email: email}, {lastVisited: 1, settings: 1}); if(!document.lastVisited) {return null;} var lastVisited = db.hadronUsers.findOne({ $or: [{email: email, \'boards.name\': document.lastVisited.name}, {\'boards.shared.userIds\':{ $in : [email]}, \'boards.name\': document.lastVisited.name}] }); for(var k=0;k<lastVisited.boards.length;k++) { if(lastVisited.boards[k].name === document.lastVisited.name) { var board = lastVisited.boards[k]; for(var i=0; i< board.textDocuments.length;i++) { if(board.lastVisited.name == board.textDocuments[i].name) {board.textDocument = board.textDocuments[i]; board.ownerEmail = board.lastVisited.email; delete board.textDocuments; delete board.lastVisited; return { board: board, assignedUserColor: document.settings.assignedUserColor};}}}} return null;}',
		CHANGE_BOARD_NAME: 'function(email, boardName, newBoardName){ var document = db.hadronUsers.findOne({email:email, \'boards.name\': newBoardName}, {email: 1}); if(document!= null){ return {saved: false};} document = db.hadronUsers.findOne({email:email}); for(var i=0;i<document.boards.length;i++){if(document.boards[i].name == boardName){ document.boards[i].name = newBoardName; if(document.lastVisited.name === boardName && document.lastVisited.email === email){document.lastVisited.name = newBoardName;} db.hadronUsers.save(document); return {saved:true};}} return {saved: false}; }',
		CHANGE_TEXT_DOCUMENT_NAME: 'function(ownerEmail, boardName, textDocumentName, newTextDocumentName){ var document = db.hadronUsers.findOne({email:ownerEmail}); for(var i=0;i<document.boards.length;i++){if(document.boards[i].name == boardName){ var board = document.boards[i]; for(var j=0;j<board.textDocuments.length;j++){if(board.textDocuments[j].name === textDocumentName){document.boards[i].textDocuments[j].name = newTextDocumentName; if(board.lastVisited.name === textDocumentName && board.lastVisited.email === ownerEmail){ document.boards[i].lastVisited.name = newTextDocumentName;} db.hadronUsers.save(document); return {saved: true};}}}} return {saved: false}; }',
		CREATE_TEXT_DOCUMENT: 'function(email, ownerEmail, boardName, textDocumentName, roomId){ var document = db.hadronUsers.findOne({email: ownerEmail}); for(var i=0;i<document.boards.length;i++) {if(document.boards[i].name === boardName){for(var j=0;j<document.boards[i].textDocuments.length;j++){if(document.boards[i].textDocuments[j].name === textDocumentName){return null;}} var textDocument = {name: textDocumentName}; if(document.boards[i].shared && document.boards[i].shared.userIds.length !== 0) {textDocument.roomId = roomId + \'-\' + textDocumentName;} document.boards[i].textDocuments.push(textDocument); document.boards[i].lastVisited = {name: textDocumentName,email: ownerEmail}; db.hadronUsers.save(document); return textDocument;}} return null;}',
		SAVE_TEXT_DOCUMENT: 'function(ownerEmail, boardName, textDocumentName, delta){var document = db.hadronUsers.findOne({email: ownerEmail}); for(var i=0;i<document.boards.length;i++){if(document.boards[i].name === boardName){var board = document.boards[i]; for(var j=0;j<board.textDocuments.length;j++){if(board.textDocuments[j].name === textDocumentName){ document.boards[i].textDocuments[j].content = delta;  db.hadronUsers.save(document); return {saved: true}; }}}} return {saved: false};}',
		GET_BOARD_BY_NAME: 'function(email, ownerEmail, boardName){var document = db.hadronUsers.findOne({email: ownerEmail}); var me = db.hadronUsers.findOne({email: email}); if(!document) {return null;} for(var i=0;i<document.boards.length;i++){ if(document.boards[i].name === boardName) { me.lastVisited.name = boardName; me.lastVisited.email = ownerEmail; db.hadronUsers.save(me); var board = document.boards[i]; board.ownerEmail = ownerEmail; document.board = board; delete document.boards; for(var j=0;j<board.textDocuments.length;j++){if(board.textDocuments[j].name = board.lastVisited.name){board.textDocument=board.textDocuments[j]; delete board.textDocuments; delete board.lastVisited; return board;}}}} return null;}',
		GET_TEXT_DOCUMENT_BY_NAME: 'function(ownerEmail, boardName, textDocumentName){var document = db.hadronUsers.findOne({email: ownerEmail, \'boards.name\': boardName}); for(var i=0;i<document.boards.length;i++){ if(document.boards[i].name === boardName) { var board = document.boards[i]; for(var j=0;j<board.textDocuments.length;j++){ if(board.textDocuments[j].name === textDocumentName) { document.boards[i].lastVisited = {email: ownerEmail, name: textDocumentName}; db.hadronUsers.save(document);  return board.textDocuments[j];}}}} return null;}',
		SHARE_BOARD: 'function(email, shareEmail, boardName, roomId){ var document = db.hadronUsers.findOne({email:shareEmail}, {email:1});  if(document && document.email) { var toUpdate = db.hadronUsers.findOne({email:email}); for(var i=0;i<toUpdate.boards.length;i++){ if(toUpdate.boards[i].name === boardName){toUpdate.boards[i].shared.userIds.push(shareEmail); for(var j=0;j<toUpdate.boards[i].textDocuments.length;j++){if(!toUpdate.boards[i].textDocuments[j].roomId){toUpdate.boards[i].textDocuments[j].roomId = roomId + \'-\' + toUpdate.boards[i].textDocuments[j].name;}} db.hadronUsers.save(toUpdate); return {saved:true}; }}}else{return {saved: false};} }',
		GET_LAST_MODIFIED_BOARD: 'function(email){  var document = db.hadronUsers.findOne({email: email}, {lastVisited: 1}); if(!document.lastVisited) {return null;} var lastVisited = db.hadronUsers.findOne({ $or: [{email: email, \'boards.name\': document.lastVisited.name}, {\'boards.shared.userIds\':{ $in : [email]}, \'boards.name\': document.lastVisited.name}] }); for(var k=0;k<lastVisited.boards.length;k++) { if(lastVisited.boards[k].name === document.lastVisited.name) { var board = lastVisited.boards[k]; for(var i=0; i< board.textDocuments.length;i++) { if(board.lastVisited.name == board.textDocuments[i].name) {board.textDocument = board.textDocuments[i]; board.ownerEmail = board.lastVisited.email; delete board.textDocuments; delete board.lastVisited; return board;}}}} return null;}'

	};
};